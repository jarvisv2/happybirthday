// Configuration
const COUNTDOWN_START = 10;
const CAKE_ANIMATION_DURATION = 8000;
const titleLetter = "To My Special Supriya";
let datetxt = "2 Nov 1999";
let datatxtletter = "Happy birthday to the most beautiful, special girl in my heart. May your birthday be as beautiful and special as you are. Wishing you all the happiness your heart can hold on your special day.ðŸ’•";

// Phase management
let currentPhase = 'countdown';

// Initialize on page load
window.addEventListener('DOMContentLoaded', function() {
    startCountdown();
});

// COUNTDOWN PHASE
function startCountdown() {
    let count = COUNTDOWN_START;
    const countdownElement = document.getElementById('countdown');
    const countdownPhase = document.getElementById('countdown-phase');
    
    // Create particles
    createParticles();
    
    const countdownInterval = setInterval(function() {
        count--;
        
        if (count > 0) {
            countdownElement.textContent = count;
            countdownElement.style.animation = 'none';
            setTimeout(() => {
                countdownElement.style.animation = 'countdownPulse 1s ease-in-out';
            }, 10);
        } else {
            clearInterval(countdownInterval);
            // Transition to cake phase
            setTimeout(() => {
                transitionToPhase('cake');
                startMusic();
            }, 500);
        }
    }, 1000);
}

function createParticles() {
    const particlesContainer = document.getElementById('particles');
    const particleCount = 30;
    
    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 3 + 's';
        particle.style.animationDuration = (Math.random() * 2 + 2) + 's';
        particlesContainer.appendChild(particle);
    }
}

// MUSIC PHASE
function startMusic() {
    const musicIndicator = document.querySelector('.now-playing');
    
    // Try to play the embedded YouTube video
    const iframe = document.getElementById('youtube-player');
    if (iframe) {
        // YouTube autoplay is handled in the iframe src
        console.log('Music player started');
    }
    
    // Add pulse animation to music indicator
    if (musicIndicator) {
        musicIndicator.style.animation = 'pulse 2s ease-in-out infinite';
    }
}

// CAKE CUTTING PHASE
function startCakeAnimation() {
    createConfetti();
    
    // After animation completes, show main page
    setTimeout(() => {
        transitionToPhase('main');
        initMainPage();
    }, CAKE_ANIMATION_DURATION);
}

function createConfetti() {
    const confettiContainer = document.getElementById('confetti');
    const colors = ['#ff6b9d', '#c06c84', '#ffeb3b', '#00bcd4', '#4caf50'];
    const confettiCount = 50;
    
    for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 3 + 's';
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        confettiContainer.appendChild(confetti);
    }
}

// PHASE TRANSITION
function transitionToPhase(phase) {
    const phases = {
        'countdown': document.getElementById('countdown-phase'),
        'cake': document.getElementById('cake-phase'),
        'main': document.getElementById('main-phase')
    };
    
    // Hide current phase
    Object.values(phases).forEach(phaseElement => {
        phaseElement.classList.remove('active');
    });
    
    // Show new phase
    setTimeout(() => {
        phases[phase].classList.add('active');
        
        if (phase === 'cake') {
            startCakeAnimation();
        }
    }, 500);
    
    currentPhase = phase;
}

// MAIN PAGE INITIALIZATION
function initMainPage() {
    // Date of birth animation
    let charArrDate = datetxt.split('');
    let currentIndex = 0;
    let date__of__birth = document.querySelector(".date__of__birth span");
    
    setTimeout(function(){
        let timeDatetxt = setInterval(function(){
            if(currentIndex < charArrDate.length){
                date__of__birth.textContent += charArrDate[currentIndex];
                currentIndex++;
            }
            else{
                let i = document.createElement("i");
                i.className = "fa-solid fa-star"
                document.querySelector(".date__of__birth").prepend(i)
                document.querySelector(".date__of__birth").appendChild(i.cloneNode(true))
                clearInterval(timeDatetxt)
            }
        },100)
    },2000)

    // Letter functionality
    var intervalContent;
    var intervalTitle;
    let charArrDateLetter = datatxtletter.split('');
    let charArrTitle = titleLetter.split('');
    let currentIndexLetter = 0;
    let currentIndexTitle = 0;
    let text__letter = document.querySelector(".text__letter p");
    
    $("#btn__letter").on("click", function(){
        $(".box__letter").slideDown()
        setTimeout(function(){
            $(".letter__border").slideDown();
        },1000)
        setTimeout(function(){
            intervalTitle = setInterval(function(){
                if(currentIndexTitle < charArrTitle.length){
                    document.querySelector(".title__letter").textContent += charArrTitle[currentIndexTitle];
                    let i = document.createElement("i");
                    i.className = "fa-solid fa-heart"
                    document.querySelector(".title__letter").appendChild(i)
                    currentIndexTitle++;
                }
                else{
                    clearInterval(intervalTitle)
                }
            },100)
        },2000)
        setTimeout(function(){
            document.querySelector("#heart__letter").classList.add("animationOp");
            document.querySelector(".love__img").classList.add("animationOp");
            document.querySelector("#mewmew").classList.add("animationOp");
        },2800)
        setTimeout(function(){
            document.querySelectorAll(".heart").forEach((item)=>{
                item.classList.add("animation")
            })
        },3500)
        setTimeout(function(){
            intervalContent = setInterval(function(){
                if(currentIndexLetter < charArrDateLetter.length){
                    text__letter.textContent += charArrDateLetter[currentIndexLetter];
                    currentIndexLetter++;
                }
                else{
                    clearInterval(intervalContent)
                }
            },50)
        },6000)
    })
    
    $(".close").on("click", function(){
        clearInterval(intervalContent)
        clearInterval(intervalTitle)
        document.querySelector(".title__letter").textContent = "";
        text__letter.textContent = "";
        currentIndexLetter = 0
        currentIndexTitle = 0
        document.querySelector("#heart__letter").classList.remove("animationOp");
        document.querySelector(".love__img").classList.remove("animationOp");
        document.querySelector("#mewmew").classList.remove("animationOp");
        document.querySelectorAll(".heart").forEach((item)=>{
                item.classList.remove("animation")
            })
        $(".box__letter").slideUp();
        $(".letter__border").slideUp();
    })
}
