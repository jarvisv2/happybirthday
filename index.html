<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Celebration</title>

  <!-- Your existing stylesheet -->
  <link rel="stylesheet" href="style.css" />

  <!-- Optional: Font Awesome already used in your page; keep if present -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- YouTube IFrame API -->
  <script>
    // predeclare callback for YT API readiness
    window.onYouTubeIframeAPIReady = function(){};
  </script>
  <script src="https://www.youtube.com/iframe_api" defer></script>
</head>
<body>

  <!-- Countdown + Player + Cake Overlay -->
  <div id="launch-overlay" aria-hidden="true">
    <div class="overlay-inner">
      <!-- Countdown -->
      <div class="countdown">
        <svg class="ring" viewBox="0 0 120 120" aria-hidden="true">
          <circle class="bg" cx="60" cy="60" r="54"></circle>
          <circle class="fg" cx="60" cy="60" r="54"></circle>
        </svg>
        <div id="count-num" class="count-num">5</div>
        <div class="count-label">Starting soon...</div>
      </div>

      <!-- Player (appears after countdown) -->
      <div id="player-stage" class="player-stage" hidden>
        <div id="yt-player"></div>
      </div>

      <!-- Cake + Cut button -->
      <div id="cake-stage" class="cake-stage" hidden>
        <div class="cake">
          <div class="plate"></div>
          <div class="cake-body">
            <div class="layer top"></div>
            <div class="layer middle"></div>
            <div class="layer bottom"></div>
            <div class="icing"></div>
            <div class="candle">
              <div class="flame"></div>
            </div>
          </div>
          <div class="slice slice-left"></div>
          <div class="slice slice-right"></div>
        </div>
        <button id="cut-btn" class="cut-btn" type="button" aria-label="Cut the cake">Cut the cake</button>
        <button id="play-fallback" class="fallback-btn" type="button" hidden>Play music</button>
        <div id="confetti"></div>
      </div>
    </div>
  </div>

  <!-- Your existing page starts here; it will be revealed after cake cut -->
  <div id="wrapper">
    <!-- Keep all of your original markup here exactly as in your current file -->
  </div>

  <!-- Overlay logic -->
  <script>
    (function () {
      const overlay = document.getElementById('launch-overlay');
      const countNum = document.getElementById('count-num');
      const fg = document.querySelector('.ring .fg');
      const playerStage = document.getElementById('player-stage');
      const cakeStage = document.getElementById('cake-stage');
      const cutBtn = document.getElementById('cut-btn');
      const fallbackBtn = document.getElementById('play-fallback');
      const wrapper = document.getElementById('wrapper');
      if (wrapper) wrapper.classList.add('hidden-initial');

      // Countdown 5 -> 0
      let secs = 5;
      const full = 2 * Math.PI * 54;
      function updateRing(s) {
        const progress = (5 - s) / 5;
        fg.style.strokeDashoffset = progress * full;
      }
      countNum.textContent = secs;
      updateRing(secs);
      const tick = setInterval(() => {
        secs--;
        countNum.textContent = secs;
        updateRing(secs);
        if (secs <= 0) {
          clearInterval(tick);
          startPlayerThenCake();
        }
      }, 1000);

      // YouTube Player
      let ytReady = false;
      let player;
      window.onYouTubeIframeAPIReady = function () {
        ytReady = true;
      };

      function startPlayerThenCake() {
        playerStage.hidden = false;
        const create = () => {
          try {
            player = new YT.Player('yt-player', {
              videoId: 'kcGojPJzh1k', // requested track
              playerVars: {
                autoplay: 1,
                controls: 0,
                modestbranding: 1,
                rel: 0,
                playsinline: 1,
                mute: 1,
                start: 0
              },
              events: {
                onReady: (e) => {
                  e.target.playVideo();
                  setTimeout(() => cakeStage.hidden = false, 800);
                }
              }
            });
          } catch (err) {
            fallbackBtn.hidden = false;
            cakeStage.hidden = false;
          }
        };
        if (ytReady && window.YT && YT.Player) create();
        else {
          const iv = setInterval(() => {
            if (ytReady && window.YT && YT.Player) {
              clearInterval(iv);
              create();
            }
          }, 100);
          setTimeout(() => {
            if (!player) {
              fallbackBtn.hidden = false;
              cakeStage.hidden = false;
            }
          }, 3000);
        }
      }

      // Fallback manual play
      fallbackBtn.addEventListener('click', () => {
        try { player && player.playVideo && player.playVideo(); } catch {}
        fallbackBtn.hidden = true;
      });

      // Confetti
      function burstConfetti(root, count = 80) {
        const colors = ['#ff7882', '#ffd46a', '#6ad2ff', '#baffc9', '#fff8e4'];
        const w = root.clientWidth;
        for (let i = 0; i < count; i++) {
          const b = document.createElement('div');
          b.className = 'confetti-bit';
          b.style.left = Math.random() * w + 'px';
          b.style.top = '-10px';
          b.style.background = colors[Math.floor(Math.random()*colors.length)];
          b.style.animationDelay = (Math.random()*0.4) + 's';
          b.style.transform = `translateY(-${20+Math.random()*20}vh)`;
          root.appendChild(b);
          setTimeout(() => b.remove(), 1600);
        }
      }

      // Cut action
      cutBtn.addEventListener('click', () => {
        const cake = document.querySelector('.cake');
        cake.classList.add('cut');
        burstConfetti(document.getElementById('confetti'), 80);
        try {
          if (player && player.unMute) { player.unMute(); player.setVolume(80); }
          if (player && player.playVideo) player.playVideo();
        } catch {}
        setTimeout(() => {
          overlay.style.opacity = '0';
          overlay.style.pointerEvents = 'none';
          if (wrapper) wrapper.classList.remove('hidden-initial');
          setTimeout(() => overlay.remove(), 500);
        }, 1200);
      });
    })();
  </script>

  <!-- Keep your original scripts (e.g., jQuery effects) below or above this block as needed -->
</body>
</html>
